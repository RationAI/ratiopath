
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../annotations/">
      
      
        <link rel="next" href="../../installation/">
      
      
      <link rel="icon" href="../../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.18">
    
    
      
        <title>Attaching Overlay Data to Image Tiles - RatioPath</title>
      
    
    
      <link rel="stylesheet" href="../../../../assets/stylesheets/main.7e37652d.min.css">
      
        
        <link rel="stylesheet" href="../../../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("../../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#attaching-overlay-data-to-image-tiles" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <div data-md-color-scheme="default" data-md-component="outdated" hidden>
        
      </div>
    
    
      

  

<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../../.." title="RatioPath" class="md-header__button md-logo" aria-label="RatioPath" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            RatioPath
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Attaching Overlay Data to Image Tiles
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1M8 13h8v-2H8zm9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4a5 5 0 0 0 5-5 5 5 0 0 0-5-5"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="black" data-md-color-accent="indigo"  aria-label="Switch to system preference"  type="radio" name="__palette" id="__palette_2">
    
      <label class="md-header__button md-icon" title="Switch to system preference" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5M7 15a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
          <a href="javascript:void(0)" class="md-search__icon md-icon" title="Share" aria-label="Share" data-clipboard data-clipboard-text="" data-md-component="search-share" tabindex="-1">
            
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91s2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08"/></svg>
          </a>
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/RationAI/ratiopath" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../../.." class="md-tabs__link">
        
  
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
    
  
  
    
    
      
  
  
  
    
  
  
    
    
      
  
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../" class="md-tabs__link">
          
  
  
    
  
  Learn

        </a>
      </li>
    
  

    
  

    
  

      
        
  
  
  
  
    
    
      
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../../reference/tiling/annotations/" class="md-tabs__link">
          
  
  
    
  
  Reference

        </a>
      </li>
    
  

    
  

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../../.." title="RatioPath" class="md-nav__button md-logo" aria-label="RatioPath" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    RatioPath
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/RationAI/ratiopath" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
      
        
      
    
    
    
      
        
        
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" checked>
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    Learn
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Learn
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    
    
      
        
      
        
      
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_1" checked>
        
          
          <label class="md-nav__link" for="__nav_2_1" id="__nav_2_1_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    GET STARTED
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_1_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2_1">
            <span class="md-nav__icon md-icon"></span>
            GET STARTED
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_1_1" checked>
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Quick Start
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_2_1_1" id="__nav_2_1_1_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_2_1_1_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2_1_1">
            <span class="md-nav__icon md-icon"></span>
            Quick Start
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../tiling/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Building a Tiling Pipeline
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../annotations/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Adding Annotation Coverage to Tiles
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    Attaching Overlay Data to Image Tiles
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    Attaching Overlay Data to Image Tiles
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#step-1-understanding-overlay-tiling-and-coordinate-system" class="md-nav__link">
    <span class="md-ellipsis">
      Step 1: Understanding Overlay Tiling and Coordinate System
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Step 1: Understanding Overlay Tiling and Coordinate System">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#essential-tile-overlay-metadata" class="md-nav__link">
    <span class="md-ellipsis">
      Essential Tile Overlay Metadata
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-2-attaching-the-overlay-patches-tile_overlay" class="md-nav__link">
    <span class="md-ellipsis">
      Step 2: Attaching the Overlay Patches (tile_overlay)
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Step 2: Attaching the Overlay Patches (tile_overlay)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#21-augmenting-with-overlay-path" class="md-nav__link">
    <span class="md-ellipsis">
      2.1 Augmenting with Overlay Path
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#22-define-the-region-of-interest-roi" class="md-nav__link">
    <span class="md-ellipsis">
      2.2 Define the Region of Interest (ROI)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#23-extracting-overlay-patches" class="md-nav__link">
    <span class="md-ellipsis">
      2.3 Extracting Overlay Patches
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-3-computing-overlay-overlapcoverage-tile_overlay_overlap" class="md-nav__link">
    <span class="md-ellipsis">
      Step 3: Computing Overlay Overlap/Coverage (tile_overlay_overlap)
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Step 3: Computing Overlay Overlap/Coverage (tile_overlay_overlap)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#post-processing-the-overlap-data" class="md-nav__link">
    <span class="md-ellipsis">
      Post-Processing the Overlap Data
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#notes-and-implementation-details" class="md-nav__link">
    <span class="md-ellipsis">
      Notes and Implementation Details
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Notes and Implementation Details">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#resolution-scaling-mu-mpx" class="md-nav__link">
    <span class="md-ellipsis">
      Resolution Scaling ($\mu m/px$)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#backend-handling" class="md-nav__link">
    <span class="md-ellipsis">
      Backend Handling
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../installation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Installation
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Reference
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Reference
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_1" >
        
          
          <label class="md-nav__link" for="__nav_3_1" id="__nav_3_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Tiling
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_1">
            <span class="md-nav__icon md-icon"></span>
            Tiling
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../reference/tiling/annotations/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    annotations
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../reference/tiling/overlays/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    overlays
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../reference/tiling/read_slide_tile/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    read_slide_tile
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../reference/tiling/tilers/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    tilers
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../reference/tiling/utils/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    utils
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_2" >
        
          
          <label class="md-nav__link" for="__nav_3_2" id="__nav_3_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Parsers
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_2">
            <span class="md-nav__icon md-icon"></span>
            Parsers
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../reference/parsers/asap/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    ASAPParser
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../reference/parsers/geojson/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    GeoJSONParser
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_3" >
        
          
          <label class="md-nav__link" for="__nav_3_3" id="__nav_3_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Augmentations
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_3">
            <span class="md-nav__icon md-icon"></span>
            Augmentations
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../reference/augmentations/estimate_stain_vectors/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    estimate_stain_vectors
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../reference/augmentations/stain_augmentor/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    StainAugmentor
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_4" >
        
          
          <label class="md-nav__link" for="__nav_3_4" id="__nav_3_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Ray
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_4">
            <span class="md-nav__icon md-icon"></span>
            Ray
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../reference/ray/read_slides/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    read_slides
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../reference/ray/vips_tiff_datasink/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    VipsTiffDatasink
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../reference/openslide/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    OpenSlide
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#step-1-understanding-overlay-tiling-and-coordinate-system" class="md-nav__link">
    <span class="md-ellipsis">
      Step 1: Understanding Overlay Tiling and Coordinate System
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Step 1: Understanding Overlay Tiling and Coordinate System">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#essential-tile-overlay-metadata" class="md-nav__link">
    <span class="md-ellipsis">
      Essential Tile Overlay Metadata
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-2-attaching-the-overlay-patches-tile_overlay" class="md-nav__link">
    <span class="md-ellipsis">
      Step 2: Attaching the Overlay Patches (tile_overlay)
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Step 2: Attaching the Overlay Patches (tile_overlay)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#21-augmenting-with-overlay-path" class="md-nav__link">
    <span class="md-ellipsis">
      2.1 Augmenting with Overlay Path
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#22-define-the-region-of-interest-roi" class="md-nav__link">
    <span class="md-ellipsis">
      2.2 Define the Region of Interest (ROI)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#23-extracting-overlay-patches" class="md-nav__link">
    <span class="md-ellipsis">
      2.3 Extracting Overlay Patches
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-3-computing-overlay-overlapcoverage-tile_overlay_overlap" class="md-nav__link">
    <span class="md-ellipsis">
      Step 3: Computing Overlay Overlap/Coverage (tile_overlay_overlap)
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Step 3: Computing Overlay Overlap/Coverage (tile_overlay_overlap)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#post-processing-the-overlap-data" class="md-nav__link">
    <span class="md-ellipsis">
      Post-Processing the Overlap Data
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#notes-and-implementation-details" class="md-nav__link">
    <span class="md-ellipsis">
      Notes and Implementation Details
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Notes and Implementation Details">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#resolution-scaling-mu-mpx" class="md-nav__link">
    <span class="md-ellipsis">
      Resolution Scaling ($\mu m/px$)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#backend-handling" class="md-nav__link">
    <span class="md-ellipsis">
      Backend Handling
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="attaching-overlay-data-to-image-tiles">Attaching Overlay Data to Image Tiles</h1>
<p>This tutorial demonstrates how to <strong>enrich your primary tile dataset</strong> with corresponding image patches (overlays) from a secondary <strong>whole-slide image (WSI)</strong>, such as a tissue mask or a heatmap. You will use <strong>Ray Data's batch processing</strong> with the <code>tile_overlay</code> and <code>tile_overlay_overlap</code> functions from the <code>ratiopath</code> library.</p>
<hr />
<h2 id="step-1-understanding-overlay-tiling-and-coordinate-system">Step 1: Understanding Overlay Tiling and Coordinate System</h2>
<p>Overlays (e.g., tissue masks) are often image files that are <strong>aligned with the original WSI</strong> but frequently have a <strong>different physical resolution</strong> ($\mu m/px$). The <code>ratiopath</code> functions, <code>tile_overlay</code> and <code>tile_overlay_overlap</code>, automatically handle these resolution differences and apply the necessary scaling to adjust tile coordinates before reading the overlay patches.</p>
<h3 id="essential-tile-overlay-metadata"><strong>Essential Tile Overlay Metadata</strong></h3>
<p>Both presented functions, <code>tile_overlay</code> and <code>tile_overlay_overlap</code>, are Ray's User Defined Function Expressions (<code>UDFExpr</code>) that process batches of data provided as column expressions. Both functions further require a Region of Interest (ROI) which defines the area of interets relative to each provided underlaying tile. The ROI must be define in the underlying tile's space (physical resolution). There are no limits for the shape of the ROI it can be an arbitrary polygon, neither the size, it may exceed the underlying tile. The ROIs that may exceed beyond the overlay image bounds are automatically clipped to the overlay image bounds.</p>
<p>To correctly locate, scale, and extract the corresponding overlay patch, the processing function require following metadata.</p>
<table>
<thead>
<tr>
<th style="text-align: left;">Column</th>
<th style="text-align: left;">Data Type</th>
<th style="text-align: left;">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><code>tile_x</code>, <code>tile_y</code></td>
<td style="text-align: left;"><code>int</code></td>
<td style="text-align: left;">Top-left pixel coordinates of the tile <strong>in the primary slide's coordinate system</strong>.</td>
</tr>
<tr>
<td style="text-align: left;"><code>tile_extent_x</code>, <code>tile_extent_y</code></td>
<td style="text-align: left;"><code>int</code></td>
<td style="text-align: left;">Width/Height of the tile <strong>in the primary slide's coordinate system</strong>.</td>
</tr>
<tr>
<td style="text-align: left;"><code>mpp_x</code>, <code>mpp_y</code></td>
<td style="text-align: left;"><code>float</code></td>
<td style="text-align: left;">Physical resolution ($\mu m/px$) of the level used for the tile extraction.</td>
</tr>
<tr>
<td style="text-align: left;"><code>overlay_path</code></td>
<td style="text-align: left;"><code>str</code></td>
<td style="text-align: left;">File path to the overlay WSI.</td>
</tr>
</tbody>
</table>
<hr />
<h2 id="step-2-attaching-the-overlay-patches-tile_overlay">Step 2: Attaching the Overlay Patches (<code>tile_overlay</code>)</h2>
<p>First, assume you have prepared a Ray Dataset of tiles (<code>tiles</code>) following a quick-start guide, where each record contains a <code>path</code> column (the primary WSI file path).</p>
<h3 id="21-augmenting-with-overlay-path">2.1 Augmenting with Overlay Path</h3>
<p>You must augment the tile dataset to include a column with the file path to the <strong>overlay WSI</strong> that corresponds to each tile.</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Follow the tutorial in Tiling Quick Start to prepare the Ray Dataset of tiles</span>
<span class="n">slides</span> <span class="o">=</span> <span class="o">...</span>
<span class="n">tiles</span> <span class="o">=</span> <span class="o">...</span>

<span class="k">def</span><span class="w"> </span><span class="nf">add_overlay_path</span><span class="p">(</span><span class="n">batch</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Adds the overlay path for each tile in the batch.&quot;&quot;&quot;</span>
    <span class="c1"># Example: Replace the WSI extension with the mask file extension</span>
    <span class="n">batch</span><span class="p">[</span><span class="s2">&quot;tissue_mask_path&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">batch</span><span class="p">[</span><span class="s2">&quot;path&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;.mrxs&quot;</span><span class="p">,</span> <span class="s2">&quot;_tissue_mask.tiff&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">batch</span>

<span class="n">tiles</span> <span class="o">=</span> <span class="n">tiles</span><span class="o">.</span><span class="n">map_batches</span><span class="p">(</span><span class="n">add_overlay_path</span><span class="p">)</span>
</code></pre></div>
<h3 id="22-define-the-region-of-interest-roi">2.2 Define the Region of Interest (ROI)</h3>
<p>For this example, we will use a simple rectangular ROI that corresponds to the center view of each tile with half the width and height.</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">shapely.geometry</span><span class="w"> </span><span class="kn">import</span> <span class="n">box</span>


<span class="c1"># Assuming the tile size is 512x512 pixels</span>
<span class="n">roi</span> <span class="o">=</span> <span class="n">box</span><span class="p">(</span><span class="mi">128</span><span class="p">,</span> <span class="mi">128</span><span class="p">,</span> <span class="mi">384</span><span class="p">,</span> <span class="mi">384</span><span class="p">)</span> <span class="c1"># A box from (128,128) to (384,384)</span>
</code></pre></div>
<h3 id="23-extracting-overlay-patches">2.3 Extracting Overlay Patches</h3>
<p>We can now use the <code>tile_overlay</code> function to extract the overlay patches corresponding to each tile. We will store the extracted overlay patches in a new column called <code>tissue_overlay</code>.</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">ratiopath.tiling</span><span class="w"> </span><span class="kn">import</span> <span class="n">tile_overlay</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">ray.data.expressions</span><span class="w"> </span><span class="kn">import</span> <span class="n">col</span>


<span class="n">tile_with_overlay</span> <span class="o">=</span> <span class="n">tiles</span><span class="o">.</span><span class="n">with_column</span><span class="p">(</span>
    <span class="s2">&quot;tissue_overlay&quot;</span><span class="p">,</span>  <span class="c1"># New column name for the overlay patch</span>
    <span class="n">tile_overlay</span><span class="p">(</span>
        <span class="n">roi</span><span class="o">=</span><span class="n">roi</span><span class="p">,</span>
        <span class="n">overlay_path</span><span class="o">=</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;tissue_mask_path&quot;</span><span class="p">),</span>
        <span class="n">tile_x</span><span class="o">=</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;tile_x&quot;</span><span class="p">),</span>
        <span class="n">tile_y</span><span class="o">=</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;tile_y&quot;</span><span class="p">),</span>
        <span class="n">mpp_x</span><span class="o">=</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;mpp_x&quot;</span><span class="p">),</span>
        <span class="n">mpp_y</span><span class="o">=</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;mpp_y&quot;</span><span class="p">),</span>
    <span class="p">),</span>
    <span class="n">num_cpus</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">memory</span><span class="o">=</span><span class="mi">4</span> <span class="o">*</span> <span class="mi">1024</span><span class="o">**</span><span class="mi">3</span><span class="p">,</span>
<span class="p">)</span>
</code></pre></div>
<p>The <code>tiles_with_overlays</code> dataset will now include a new column, <code>tissue_overlay</code>, containing the raw overlay image patches corresponding to each tile. For optimization purposes, the overlay patches are of the shape of the bounding box of the provided ROI. Unfortunately, at the moment we cannot use masked arrays directly in Ray Dataset. So instead of a numpy masked array, we provide the data and the mask as 2 separate arrays. The mask indicates which pixels are inside the ROI and which are outside.</p>
<hr />
<h2 id="step-3-computing-overlay-overlapcoverage-tile_overlay_overlap">Step 3: Computing Overlay Overlap/Coverage (<code>tile_overlay_overlap</code>)</h2>
<p>Instead of retrieving the raw image patch, you can compute the <strong>pixel ratio</strong> for every unique value in the resulting overlay patch, which is useful for filtering tiles based on content (e.g., how much tissue is present). The setup is similar to the previous step.</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">ratiopath.tiling</span><span class="w"> </span><span class="kn">import</span> <span class="n">tile_overlay_overlap</span>


<span class="n">tissue_tiles</span> <span class="o">=</span> <span class="n">tiles</span><span class="o">.</span><span class="n">with_column</span><span class="p">(</span>
    <span class="s2">&quot;tissue_overlap&quot;</span><span class="p">,</span>  <span class="c1"># New column name for the overlay patch</span>
    <span class="n">tile_overlay_overlap</span><span class="p">(</span>
        <span class="n">roi</span><span class="o">=</span><span class="n">roi</span><span class="p">,</span>
        <span class="n">overlay_path</span><span class="o">=</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;tissue_mask_path&quot;</span><span class="p">),</span>
        <span class="n">tile_x</span><span class="o">=</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;tile_x&quot;</span><span class="p">),</span>
        <span class="n">tile_y</span><span class="o">=</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;tile_y&quot;</span><span class="p">),</span>
        <span class="n">mpp_x</span><span class="o">=</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;mpp_x&quot;</span><span class="p">),</span>
        <span class="n">mpp_y</span><span class="o">=</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;mpp_y&quot;</span><span class="p">),</span>
    <span class="p">),</span>
    <span class="n">num_cpus</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">memory</span><span class="o">=</span><span class="mi">4</span> <span class="o">*</span> <span class="mi">1024</span><span class="o">**</span><span class="mi">3</span><span class="p">,</span>
<span class="p">)</span>
</code></pre></div>
<h3 id="post-processing-the-overlap-data">Post-Processing the Overlap Data</h3>
<p>The new column <code>tissue_mask_overlap</code> contains a dictionary for each tile, mapping <strong>unique pixel values</strong> (e.g., 0, 1, 255) in the overlay to their <strong>area coverage</strong> (as a fraction summing to 1). Due to PyArrow's dictionary limitations, which is used by Ray for storing the data, the keys are strings and the keys are shared across all rows. Missing keys are filled with <code>None</code>.
You can easily post-process this to extract coverage of a specific class (e.g., the foreground tissue, often value <code>255</code>):</p>
<div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">extract_foreground_coverage</span><span class="p">(</span><span class="n">tile</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Extracts the foreground coverage (value 255) from the overlap dictionary.&quot;&quot;&quot;</span>
    <span class="c1"># Use .get(255, 0.0) to safely retrieve the value, defaulting to 0.0 if not present</span>
    <span class="n">tile</span><span class="p">[</span><span class="s2">&quot;tissue_coverage&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">tile</span><span class="p">[</span><span class="s2">&quot;tissue_mask_overlap&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;255&#39;</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">tile</span>

<span class="n">tiles_with_tissue_coverage</span> <span class="o">=</span> <span class="n">tiles_with_overlap</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">extract_foreground_coverage</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
    <span class="k">lambda</span> <span class="n">tile</span><span class="p">:</span> <span class="n">tile</span><span class="p">[</span><span class="s2">&quot;tissue_coverage&quot;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mf">0.5</span>  <span class="c1"># Keep tiles with at least 50% tissue</span>
<span class="p">)</span>
</code></pre></div>
<hr />
<h2 id="notes-and-implementation-details">Notes and Implementation Details</h2>
<h3 id="resolution-scaling-mu-mpx">Resolution Scaling ($\mu m/px$)</h3>
<p>The module's core functionality relies on calculating the <strong>scaling factor</strong> ($S_x$, $S_y$) required to map the tile coordinates from the primary slide's resolution ($M_{slide}$) to the overlay's resolution ($M_{overlay}$):</p>
<p>$$S_{x} = \frac{M_{slide, x}}{M_{overlay, x}}$$</p>
<p>This factor is then applied to the tile's coordinates and dimensions. To ensure precise pixel addressing, the resulting floating-point values are rounded to the nearest integer:</p>
<p>$$\text{New_Coordinate} = \lfloor (\text{Old_Coordinate} \times S) + 0.5 \rfloor$$</p>
<h3 id="backend-handling">Backend Handling</h3>
<p>The functions automatically detect the overlay file type (e.g., OpenSlide format or OME-TIFF) and use the appropriate backend (<code>_read_openslide_overlay</code> or <code>_read_tifffile_overlay</code>) for efficient access to the overlay image pyramid, abstracting the details from the user.</p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    
      
      <nav class="md-footer__inner md-grid" aria-label="Footer" >
        
          
          <a href="../annotations/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Adding Annotation Coverage to Tiles">
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
            </div>
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Previous
              </span>
              <div class="md-ellipsis">
                Adding Annotation Coverage to Tiles
              </div>
            </div>
          </a>
        
        
          
          <a href="../../installation/" class="md-footer__link md-footer__link--next" aria-label="Next: Installation">
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Next
              </span>
              <div class="md-ellipsis">
                Installation
              </div>
            </div>
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11z"/></svg>
            </div>
          </a>
        
      </nav>
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../../../..", "features": ["announce.dismiss", "content.code.annotate", "content.code.copy", "content.code.select", "content.tooltips", "navigation.indexes", "navigation.sections", "navigation.tabs", "navigation.tabs.sticky", "navigation.footer", "search.highlight", "search.share", "search.suggest", "toc.follow"], "search": "../../../../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": {"provider": "mike"}}</script>
    
    
      <script src="../../../../assets/javascripts/bundle.92b07e13.min.js"></script>
      
    
  </body>
</html>